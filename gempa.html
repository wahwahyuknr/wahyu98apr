<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gempa Terbaru</title>
    <meta name="title" content="Gempa Terbaru" />
    <meta name="description" content="Update Bencana Alam Gempa Terbaru" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://wahyu98apr.github.io/gempa" />
    <meta property="og:title" content="Gempa Terbaru" />
    <meta property="og:description" content="Update Bencana Alam Gempa Terbaru" />
    <meta property="og:image" content="https://lh3.googleusercontent.com/-C8RAAuIpxqk/VYvD0qLi6rI/AAAAAAAAIBw/YwT8fWT2biw/s0-rw/Thumbnail.webp" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://wahyu98apr.github.io/gempa" />
    <meta property="twitter:title" content="Gempa Terbaru" />
    <meta property="twitter:description" content="Update Bencana Alam Gempa Terbaru" />
    <meta property="twitter:image" content="https://lh3.googleusercontent.com/-C8RAAuIpxqk/VYvD0qLi6rI/AAAAAAAAIBw/YwT8fWT2biw/s0-rw/Thumbnail.webp" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<style>
body{
	background-color: #22272e;
	color:#eee;
}
#oneoutput {
	text-align:center;
	border: 10px solid orange;
	box-sizing: border-box;
}
#output table{
    border:1px solid;
    margin:3%;
    padding:3%;
}
ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}
#oneoutput table th {
    text-align:right;
}
#oneoutput table td {
    text-align:left;
}
footer {
    text-align: center;
    padding: 20px;
    background-color: #333;
    color: white;
}

footer a {
    color: #007bff;
    text-decoration: none;
}

footer a:hover {
    text-decoration: underline;
}
</style>
<body>

<div id="oneoutput"></div>
<div id="output"></div>

<script>
function olahData(data){
 	var posts = "", InfoGempa = data.Infogempa.gempa;
	for (var i = 0; i < InfoGempa.length; i++) {
		var tanggal = InfoGempa[i].Tanggal,
		 jam = InfoGempa[i].Jam,
		 datetime = InfoGempa[i].DateTime,
		 coordinates = InfoGempa[i].Coordinates,
		 lintang = InfoGempa[i].Lintang,
		 bujur = InfoGempa[i].Bujur,
		 magnitude = InfoGempa[i].Magnitude,
		 kedalaman = InfoGempa[i].Kedalaman,
		 wilayah = InfoGempa[i].Wilayah,
		 dirasakan = InfoGempa[i].Dirasakan;
    posts += '<li><table>'+
    		'<tr><th>Tanggal</th><td>:</td><td>'+		tanggal+'</td></tr>'+
            '<tr><th>Jam</th><td>:</td><td>'+		jam+'</td></tr>'+
            '<tr><th>DateTime</th><td>:</td><td>'+        datetime+'</td></tr>'+
            '<tr><th>Coordinates</th><td>:</td><td>'+        coordinates+'</td></tr>'+
            '<tr><th>Lintang</th><td>:</td><td>'+        lintang+'</td></tr>'+
            '<tr><th>Bujur</th><td>:</td><td>'+        bujur+'</td></tr>'+
            '<tr><th>Magnitude</th><td>:</td><td>'+        magnitude+'</td></tr>'+
            '<tr><th>Kedalaman</th><td>:</td><td>'+        kedalaman+'</td></tr>'+
            '<tr><th>Wilayah</th><td>:</td><td>'+        wilayah+'</td></tr>'+
            '<tr><th>Dirasakan</th><td>:</td><td>'+        dirasakan+'</td></tr>'+
            '</table></li>';
	}

document.getElementById('output').innerHTML = '<ul>'+posts+'</ul>';

	
}
function olahData2(data){
	var InfoGempa = data.Infogempa.gempa,
		 tanggal = InfoGempa.Tanggal,
		 jam = InfoGempa.Jam,
		 datetime = InfoGempa.DateTime,
		 coordinates = InfoGempa.Coordinates,
		 lintang = InfoGempa.Lintang,
		 bujur = InfoGempa.Bujur,
		 magnitude = InfoGempa.Magnitude,
		 kedalaman = InfoGempa.Kedalaman,
		 wilayah = InfoGempa.Wilayah,
		 potensi = InfoGempa.Potensi,
		 dirasakan = InfoGempa.Dirasakan,
		 shakemap = 'https://data.bmkg.go.id/DataMKG/TEWS/'+InfoGempa.Shakemap, 
		 peta = '<a href="'+shakemap+'" target="_blank"><img style="width:100%;max-width:360px" alt="'+wilayah+'" title="'+wilayah+'" src="'+shakemap+'"/></a>'+
				'<br /><a target="_blank" href="https://www.google.com/maps/?q='+coordinates+'"><button>VIEW LOCATION IN GOOGLE MAPS</button></a>'
		 ;
    posts = '<center><table>'+
    		'<tr><th>Tanggal</th><td>:</td><td>'+		tanggal+'</td></tr>'+
            '<tr><th>Jam</th><td>:</td><td>'+		jam+'</td></tr>'+
            '<tr><th>DateTime</th><td>:</td><td>'+        datetime+'</td></tr>'+
            '<tr><th>Coordinates</th><td>:</td><td>'+        coordinates+'</td></tr>'+
            '<tr><th>Lintang</th><td>:</td><td>'+        lintang+'</td></tr>'+
            '<tr><th>Bujur</th><td>:</td><td>'+        bujur+'</td></tr>'+
            '<tr><th>Magnitude</th><td>:</td><td>'+        magnitude+'</td></tr>'+
            '<tr><th>Kedalaman</th><td>:</td><td>'+        kedalaman+'</td></tr>'+
            '<tr><th>Wilayah</th><td>:</td><td>'+        wilayah+'</td></tr>'+
            '<tr><th>Potensi</th><td>:</td><td>'+        potensi+'</td></tr>'+
            '<tr><th>Dirasakan</th><td>:</td><td>'+        dirasakan+'</td></tr>'+
             '</table></center>';
document.getElementById('oneoutput').innerHTML = peta+'<ul>'+posts+'</ul>';		 
}

$(document).ready(function() {

        $.ajax({
            url: 'https://data.bmkg.go.id/DataMKG/TEWS/gempadirasakan.json',
            dataType: 'json',
            success: function(data) {olahData(data)},
            error: function(xhr, status, error) {
                console.error(status + ': ' + error);
                $('#output').text('Error fetching JSON data.');
            }
        });
		
        $.ajax({
            url: 'https://data.bmkg.go.id/DataMKG/TEWS/autogempa.json',
            dataType: 'json',
            success: function(data) {olahData2(data)},
            error: function(xhr, status, error) {
                console.error(status + ': ' + error);
                $('#oneoutput').text('Error fetching JSON data.');
            }
        });

});


    // Function to check if data.json is updated
    async function checkAndUpdateNotification() {
      try {
        const response = await fetch('https://data.bmkg.go.id/DataMKG/TEWS/autogempa.json');
        const data = await response.json();

        // Extract the timestamp from data.json
        const lastUpdateTimestamp = new Date(data.Infogempa.gempa.DateTime).getTime();

        // Check if the data has been updated (compare with stored timestamp or use other criteria)
        if (lastUpdateTimestamp > storedTimestamp) {
          // Data has been updated, show notification
          showNotification('Earthquake Update', `Magnitude ${data.Infogempa.gempa.Magnitude} earthquake occurred at ${data.Infogempa.gempa.Wilayah}.`);

          // Update stored timestamp for future comparisons
          storedTimestamp = lastUpdateTimestamp;
        }
      } catch (error) {
        console.error('Error fetching or parsing data.json:', error);
      }
    }

    // Function to show a notification
    function showNotification(title, message) {
      if ('Notification' in window && Notification.permission === 'granted') {
        // Create and show the notification
        var notification = new Notification(title, {
          body: message,
          icon: './icon.png'
        });

        // Optional: Handle click on the notification
        notification.onclick = function () {
          // Do something when the user clicks the notification
        };
      }
    }

    // Function to request notification permission
    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission().then(function (permission) {
          if (permission === 'granted') {
            // Permission granted, you can now show notifications
            console.log('Notification permission granted.');
          } else {
            console.warn('Notification permission denied.');
          }
        });
      } else {
        console.error('This browser does not support notifications.');
      }
    }

    // Add click event listener to the button
    document.getElementById('requestPermissionBtn').addEventListener('click', requestNotificationPermission);

    // Assuming you have a stored timestamp, update it as needed
    let storedTimestamp = 0; // Replace with the actual stored timestamp

    // Call the function to check and update the notification
    checkAndUpdateNotification();

    // Set up a periodic check every 30 seconds
    setInterval(checkAndUpdateNotification, 30 * 1000); // 30 seconds interval





</script>
<i>
Sumber Data BMKG (Badan Meteorologi, Klimatologi, dan Geofisika) - Situs ini dibuat menggunakan JS jQuery v3.6.0 dengan memanggil data API pembaruan gempa dari server BMKG
</i>
    <footer>
        <p>Created by Wahyu98Apr | <a href="https://instagram.com/wahyu98apr">Instagram</a></p>
    </footer>
</body>
</html>
